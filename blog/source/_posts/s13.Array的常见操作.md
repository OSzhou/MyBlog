---
banner: /css/images/tree_04.jpg
title: Arrayçš„å¸¸è§æ“ä½œ
date: 2020-11-20 12:31:57
tags: Swift
thumbnail: /css/images/tree_04.jpg
categories:
- iOSå¼€å‘
---

- `map` / `filter` / `reduce`
```
var arr = [1, 2, 3, 4]
// [2, 4, 6, 8]
var arr2 = arr.map { $0 * 2 }
// [2, 4]
var arr3 = arr.filter { $0 % 2 == 0 } // 10
var arr4 = arr.reduce(0) { $0 + $1 } // 10
// å¯ç®€å†™ä¸º
var arr5 = arr.reduce(0, +)
```
- `map`æŽ¥æ”¶å‡½æ•°ä½œä¸ºå‚æ•°
```
func double(_ i: Int) -> Int { i * 2 } 
var arr = [1, 2, 3, 4]
// [2, 4, 6, 8] 
print(arr.map(double))
```
<!--more-->
- `compactMap`é»˜è®¤è§£åŒ…å¹¶åŽ»é™¤nil
```
var arr = ["123", "test", "jack", "-30"] 

// [Optional(123), nil, nil, Optional(-30)] 
var arr2 = arr.map { Int($0) }

// [123, -30]
var arr3 = arr.compactMap { Int($0) }
```
- ä½¿ç”¨`reduce`å®žçŽ°`map`ã€`filter`å‡½æ•°çš„åŠŸèƒ½
```
var arr = [1, 2, 3, 4]

// [2, 4, 6, 8]
print(arr.map { $0 * 2 }) 
// ç­‰ä»·äºŽðŸ‘†å‡½æ•°åŠŸèƒ½
print(arr.reduce([]) { $0 + [$1 * 2] })

// [2, 4]
print(arr.filter { $0 % 2 == 0 }) 
// ç­‰ä»·äºŽðŸ‘†å‡½æ•°åŠŸèƒ½
print(arr.reduce([]) { $1 % 2 == 0 ? $0 + [$1] : $0 })
```
- `map`,`flatMap`åŠŸèƒ½å¯¹æ¯”
```
var arr = [1, 2, 3]
// [[1], [2, 2], [3, 3, 3]] æ‹¿åˆ°ä»€ä¹ˆ(æ•°ç»„)ï¼Œè¿”å›žæ•°ç»„(äºŒç»´æ•°ç»„)å°±æ”¾ä»€ä¹ˆï¼Œä¸åšå¤„ç†ã€‚
var arr2 = arr.map { Array.init(repeating: $0, count: $0) }
// [1, 2, 2, 3, 3, 3] å°†æ‹¿åˆ°çš„æ•°ç»„ä¸­çš„å…ƒç´ å–å‡ºæ”¾åˆ°è¿”å›žæ•°ç»„(ä¸€ç»´æ•°ç»„)ä¸­ã€‚æ‰å¹³åŒ–å¤„ç†ã€‚
var arr3 = arr.flatMap { Array.init(repeating: $0, count: $0) }
```
- ç”¨`lazy`çš„ä¼˜åŒ–map
```
let arr = [1, 2, 3]
let result = arr.lazy.map {
	(i: Int) -> Int in 
	print("mapping \(i)") 
	return i * 2
}
print("begin-----")
print("mapped", result[0]) 
print("mapped", result[1]) 
print("mapped", result[2]) 
print("end----")
// ç¬¬ä¸€æ¬¡ç”¨åˆ°æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œç›¸åº”é€»è¾‘
begin----- 
mapping 1 
mapped 2 
mapping 2 
mapped 4 
mapping 3 
mapped 6 
end----
```
- `map`å’Œ`flatMap`å¯é€‰å€¼`Optional`å¤„ç†ä¸­çš„åº”ç”¨
```
var num1: Int? = 10
// Optional(20)
var num2 = num1.map { $0 * 2 }

var num3: Int? = nil
// nilï¼Œå‘çŽ°$0ä¸ºnilç›´æŽ¥è¿”å›žnil
var num4 = num3.map { $0 * 2 }
```
`map` å’Œ `flatMap`å¯¹æ¯”
```
var num1: Int? = 10
// Optional(Optional(20)), mapè¿˜æ˜¯ä¼šå¯¹å¯é€‰å€¼å†åŒ…è£…ä¸€å±‚
var num2 = num1.map { Optional.some($0 * 2) }

// Optional(20), flatMapå‘çŽ°å·²ç»æ˜¯å¯é€‰å€¼ï¼Œå°±ä¸ä¼šå†åŒ…è£…äº†
var num3 = num1.flatMap { Optional.some($0 * 2) }
```
å¯ç”¨äºŽç®€åŒ–ä»£ç 
```
// ç¤ºä¾‹ä¸€ï¼š
var num1: Int? = 10
var num2 = (num1 != nil) ? (num1! + 10) : nil 
var num3 = num1.map { $0 + 10 }
// num2ã€num3æ˜¯ç­‰ä»·çš„

// ç¤ºä¾‹äºŒï¼š
var fmt = DateFormatter()
fmt.dateFormat = "yyyy-MM-dd"
var str: String? = "2011-09-10"
// old
var date1 = str != nil ? fmt.date(from: str!) : nil 
// new
var date2 = str.flatMap(fmt.date)

// ç¤ºä¾‹ä¸‰ï¼š
var score: Int? = 98
// old
var str1 = score != nil ? "socre is \(score!)" : "No score" 
// new
var str2 = score.map { "score is \($0)" } ?? "No score"

// ç¤ºä¾‹å››ï¼š
struct Person {
    var name: String
    var age: Int
}
var items = [
	Person(name: "jack", age: 20), 
	Person(name: "rose", age: 21), 
	Person(name: "kate", age: 22)
]
// old
func getPerson1(_ name: String) -> Person? {
	let index = items.firstIndex { $0.name == name } 
	return index != nil ? items[index!] : nil
}
// new
func getPerson2(_ name: String) -> Person? {
	return items.firstIndex { $0.name == name }.map { items[$0] }
}

// ç¤ºä¾‹äº”ï¼š
struct Person {
	var name: String
	var age: Int
	init?(_ json: [String : Any]) {
		guard let name = json["name"] as? String, 
		let age = json["age"] as? Int else {
			return nil
		}
		self.name = name 
		self.age = age
	} 
}
var json: Dictionary? = ["name" : "Jack", "age" : 10] 
// old
var p1 = json != nil ? Person(json!) : nil
// new
var p2 = json.flatMap(Person.init)
```